 (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
diff --git a/frontend/src/services/turnos.servicio.js b/frontend/src/services/turnos.servicio.js
index b964758635372abea073537c66c80296c925661a..8a79b8bd2216d8b0b724e947d936690e6004c1c9 100644
--- a/frontend/src/services/turnos.servicio.js
+++ b/frontend/src/services/turnos.servicio.js
@@ -1,47 +1,59 @@
 // src/services/turnos.servicio.js
 import axios from '../config/axios.config'; // (Ajusta la ruta si es necesario)
 
 /** Base URL (env o fallback local) */
 const API = import.meta?.env?.VITE_API_BASE_URL || "http://localhost:8080/api";
 
 /** Utils */
 const ok = (r) => r && r.status >= 200 && r.status < 300;
 const toIsoWithOffset = (d) => {
     // A veces el backend espera +00:00 en vez de Z
     const iso = new Date(d).toISOString();      // 2025-10-10T15:00:00.000Z
     return iso.replace(/\.000Z$/, "+00:00");    // 2025-10-10T15:00:00+00:00
 };
 
 // üéØ CORRECCI√ìN CLAVE 1: Helper para obtener el ID del usuario autenticado (si no se provee)
 const getAuthHeaders = (optUserId) => {
     // Fallback ID to ensure the header is always present for the backend controller
-    const userId = optUserId || 
-                   localStorage.getItem("gs_user_id") || 
-                   localStorage.getItem("userId") || 
-                   "primary"; 
-    
+    let resolvedId = optUserId ||
+                     localStorage.getItem("gs_user_id") ||
+                     localStorage.getItem("userId");
+
+    if (!resolvedId) {
+        try {
+            const storedUser = JSON.parse(localStorage.getItem("usuario") || "null");
+            if (storedUser?.id_usuario != null) {
+                resolvedId = String(storedUser.id_usuario);
+            }
+        } catch {
+            // ignore JSON errors and continue with fallback
+        }
+    }
+
+    const userId = resolvedId || "primary";
+
     return {
         headers: {
             'X-User-Id': userId
         }
     };
 };
 
 
 /**
  * Lista turnos. Intenta /turnos/entrenador/{id} y cae a /turnos?entrenadorId=...
  * Params opcionales: {desde, hasta, tipo}
  */
 export async function listarTurnos(entrenadorId, { desde, hasta, tipo } = {}) {
     const params = {};
     if (desde) params.desde = desde;
     if (hasta) params.hasta = hasta;
     if (tipo)  params.tipo  = tipo;
 
     // Ruta 1: espec√≠fica por entrenador
     if (entrenadorId != null) {
         try {
             const r1 = await axios.get(`${API}/turnos/entrenador/${entrenadorId}`, { params });
             if (ok(r1)) return r1;
         } catch { /* fallback */ }
         params.entrenadorId = entrenadorId; // para la ruta 2
 
EOF
)